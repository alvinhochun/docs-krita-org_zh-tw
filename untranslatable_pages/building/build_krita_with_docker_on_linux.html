

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-TW" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-TW" > <!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" name="title" content="Building krita with Docker on Linux" />
  <meta property="og:site-name" content="Krita Manual" />
  <meta property="og:type" content="article" />
  <meta property="og:locale" content="zh_TW" />
  <meta property="og:locale:alternate" content="ca" />
  <meta property="og:locale:alternate" content="en" />
  <meta property="og:locale:alternate" content="fr" />
  <meta property="og:locale:alternate" content="it" />
  <meta property="og:locale:alternate" content="ja" />
  <meta property="og:locale:alternate" content="ko" />
  <meta property="og:locale:alternate" content="nl" />
  <meta property="og:locale:alternate" content="pl" />
  <meta property="og:locale:alternate" content="pt_PT" />
  <meta property="og:locale:alternate" content="uk_UA" />
  <meta property="og:locale:alternate" content="zh_CN" />
  <meta property="og:article:modified_time" content="2021-07-20T07:50:31" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Guide to building Krita with docker on Linux." name="description" />

  
  
  <title>Building krita with Docker on Linux &mdash; Krita Manual 5.0.0 Beta 說明文件</title>
  

  
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    
  
  
  
    <link rel="canonical" href="zh_TW/untranslatable_pages/building/build_krita_with_docker_on_linux.html"/>
    <meta property="og:url" content="zh_TW/untranslatable_pages/building/build_krita_with_docker_on_linux.html" />
    <meta property="og:image" content="zh_TW/_static/sidebar-logo.png" />
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜尋" href="../../search.html" />
    <link rel="next" title="CMake Settings for Developers" href="../cmake_settings_for_developers.html" />
    <link rel="prev" title="Half-automatic building script on Windows" href="auto_build_script.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
       
           <a href="../../index.html" class="icon icon-home">

			<img src="../../_static/sidebar-logo.png" class="logo" alt="Logo"/>
           	
           <!--	Krita Manual -->


          </a>


          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜尋文件" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-side-nav-language-selector">
        	<p class="caption-text">
	        	<select id="language-selector-container">
	        		<option value="ca">Català</option>
	        		<option value="en">English</option>
	        		<option value="fr">français</option>
	        		<option value="it">Italiano</option>
	        		<option value="ja">日本語</option>
	        		<option value="ko">한국어</option>
	        		<option value="nl">Nederlands</option>
	        		<option value="pl">Polski</option>
	        		<option value="pt_PT">português</option>
	        		<option value="uk_UA">Українська</option>
	        		<option value="zh_CN">简体中文</option>
	        	</select>
        	</p>
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../user_manual.html">使用者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general_concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference_manual.html">參考文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">教學及指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../KritaFAQ.html">Krita 常見問題</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../contributors_manual.html">貢獻者手冊</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../contributors_manual/community.html">Krita 的社群</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributors_manual/krita_manual_conventions.html">Krita 手冊中 reStructuredText 標記格式使用慣例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributors_manual/krita_manual_readme.html">Krita 手冊貢獻指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributors_manual/optimising_images.html">供手冊使用的影像</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributors_manual/user_support.html">使用者支援入門介紹</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../untranslatable_pages.html">Technical Pages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../building_krita.html">Building Krita from Source</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../building_krita.html#building-on-linux">Building on Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building_krita.html#building-on-windows">Building on Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building_krita.html#building-on-macos">Building on macOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building_krita.html#building-on-android">Building on Android</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../building_krita.html#specialized-ways-of-building-krita">Specialized Ways of Building Krita</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cmake_settings_for_developers.html">CMake Settings for Developers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro_hacking_krita.html">Introduction to Hacking Krita</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kpl_defintion.html">The Krita Palette format KPL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../krita_svg_extensions.html">Krita SVG Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modern_cpp_in_krita.html">Modern C++ usage guidelines for the Krita codebase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../new_features.html">Developing Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optimizing_tips_for_krita.html">Optimizing tips and tools for Krita</a></li>
<li class="toctree-l3"><a class="reference internal" href="../participating_in_gsoc.html">Google Summer of Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../patch_review_guide.html">Advanced Merge Request Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python_coding.html">Python Developer Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quality_assurance.html">Introduction to Quality Assurance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release_krita.html">Making a release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reporting_bugs.html">Reporting Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../running_krita.html">Running Krita from Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../strokes_documentation.html">Strokes queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../strokes_documentation.html#strokes-public-api">Strokes public API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../strokes_documentation.html#internals-of-the-freehand-tool">Internals of the freehand tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../strokes_documentation.html#scheduled-undo-redo">Scheduled Undo/Redo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../strokes_documentation.html#processings-framework">Processings framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../testing_strategy.html">Testing Strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../triaging_bugs.html">Triaging Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../unit_tests_in_krita.html">Unittests in Krita</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../resources_page.html">資源</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

	<!-- start top banner area (for fundraisers or messages)

	<div style="text-align: center; background-color: #333">
		<a href="https://krita.org/en/fundraising-2018-campaign/" target="_self" onclick="ga('send', 'event', 'frontpage', 'button', 'Fundraiser 2018');">
			<img src="https://krita.org/wp-content/themes/krita-org-theme/images/decoration/2018-fundraiser-banner.png" style="max-width: 100%">
		</a>
	</div>
	
	 end top banner area -->

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Krita Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">文件</a> &raquo;</li>
        
          <li><a href="../../contributors_manual.html">貢獻者手冊</a> &raquo;</li>
        
          <li><a href="../../untranslatable_pages.html">Technical Pages</a> &raquo;</li>
        
          <li><a href="../building_krita.html">Building Krita from Source</a> &raquo;</li>
        
      <li>Building krita with Docker on Linux</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
          
            <a href="../../_sources/untranslatable_pages/building/build_krita_with_docker_on_linux.rst.txt" rel="nofollow"> 
             
              <img src="../../_static/images/source-code.png" />
             <!-- 檢視頁面原始碼 -->

          </a>
          
        
      </li>
    
  </ul>

  
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="building-krita-with-docker-on-linux">
<span id="building-krita-with-docker"></span><h1><a class="toc-backref" href="#id2">Building krita with Docker on Linux</a><a class="headerlink" href="#building-krita-with-docker-on-linux" title="本標題的永久連結">¶</a></h1>
<p>This guide is useful when you are an advanced developer and want to build krita with the same patched dependencies that are used for the AppImages. If you just want to hack on Krita, read the Build Krita from Source guide.</p>
<p>The <em>Dockerfile</em> is based on the official KDE build environment
that is used on KDE CI for building official AppImage packages. This guide is valid for Ubuntu and Ubuntu-based Linux distributions.</p>
<div class="contents topic" id="id1">
<p class="topic-title">目錄</p>
<ul class="simple">
<li><p><a class="reference internal" href="#building-krita-with-docker-on-linux" id="id2">Building krita with Docker on Linux</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id3">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#build-the-docker-image-and-run-the-container" id="id4">Build the docker image and run the container</a></p></li>
<li><p><a class="reference internal" href="#enter-the-container-and-build-krita" id="id5">Enter the container and build Krita</a></p></li>
<li><p><a class="reference internal" href="#building-appimage-package-for-your-version-of-krita" id="id6">Building AppImage package for your version of Krita</a></p></li>
<li><p><a class="reference internal" href="#creating-a-full-clone-of-the-container" id="id7">Creating a full clone of the container</a></p></li>
<li><p><a class="reference internal" href="#testing-merge-requests-using-container-clones" id="id8">Testing merge requests using container clones</a></p></li>
<li><p><a class="reference internal" href="#updating-dependencies-in-the-docker" id="id9">Updating dependencies in the docker</a></p></li>
<li><p><a class="reference internal" href="#extra-developer-tools" id="id10">Extra developer tools</a></p></li>
<li><p><a class="reference internal" href="#stopping-the-container-and-cleaning-up" id="id11">Stopping the container and cleaning up</a></p></li>
<li><p><a class="reference internal" href="#troubleshooting" id="id12">Troubleshooting</a></p>
<ul>
<li><p><a class="reference internal" href="#krita-binary-is-not-found-after-the-first-build" id="id13">Krita binary is not found after the first build</a></p></li>
<li><p><a class="reference internal" href="#opengl-doesn-t-work-on-nvidia-gpu-with-proprietary-drivers" id="id14">OpenGL doesn't work on NVidia GPU with proprietary drivers</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="prerequisites">
<h2><a class="toc-backref" href="#id3">Prerequisites</a><a class="headerlink" href="#prerequisites" title="本標題的永久連結">¶</a></h2>
<p>First make sure you have Docker installed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">docker</span> <span class="n">docker</span><span class="o">.</span><span class="n">io</span>
</pre></div>
</div>
<p>Decide where you want to store your Docker images. All the docker images and containers are by default stored in a special docker-daemon controlled folder under <em>/var</em> directory. You might not have enough space there for building Krita (it needs about 10 GiB). In such a case it is recommended to move the docker images
folder into another location, where there is enough space.</p>
<ol class="arabic">
<li><p>Stop docker service</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">stop</span> <span class="n">docker</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Edit the config file:</p>
<blockquote>
<div><p>On newer systems, like Ubuntu 18.04 and higher you need to open file <em>/etc/docker/daemon.json</em> and add the following json config options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;data-root&quot;</span> <span class="p">:</span> <span class="s2">&quot;/path/where/you/want/to/store/docker/images/&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you have older version of Ubuntu, e.g. Ubuntu 16.04, then you need to do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;DOCKER_OPTS=&quot;-g /path/where/you/want/to/store/docker/images/&quot;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">docker</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Restart the docker service</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">docker</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>Then you need to download deps and Krita source tree. These steps are not included into the <em>Dockerfile</em> to save internal bandwidth</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create directory structure for container control directory</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">invent</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">dkazakov</span><span class="o">/</span><span class="n">krita</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">env</span> <span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">1</span>

<span class="n">cd</span> <span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">1</span>
<span class="n">mkdir</span> <span class="n">persistent</span>

<span class="c1"># copy/checkout Krita sources to &#39;persistent/krita&#39;</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">sources</span><span class="o">/</span><span class="n">krita</span> <span class="o">./</span><span class="n">persistent</span><span class="o">/</span><span class="n">krita</span>

<span class="c1">## or ...</span>
<span class="c1"># git clone kde:krita persistent/krita</span>

<span class="c1"># download the deps archive</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
<section id="build-the-docker-image-and-run-the-container">
<h2><a class="toc-backref" href="#id4">Build the docker image and run the container</a><a class="headerlink" href="#build-the-docker-image-and-run-the-container" title="本標題的永久連結">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">build_image</span> <span class="n">krita</span><span class="o">-</span><span class="n">deps</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">run_container</span> <span class="n">krita</span><span class="o">-</span><span class="n">deps</span> <span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="enter-the-container-and-build-krita">
<h2><a class="toc-backref" href="#id5">Enter the container and build Krita</a><a class="headerlink" href="#enter-the-container-and-build-krita" title="本標題的永久連結">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># enter the docker container (the name will be</span>
<span class="c1"># fetched automatically from &#39;.container_name&#39; file)</span>

<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">enter</span>
</pre></div>
</div>
<p>... now you are inside the container with all the deps prepared ...</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># build Krita as usual</span>
<span class="c1"># you should be in ~/appimage-workspace/krita-build/</span>
<span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">run_cmake</span><span class="o">.</span><span class="n">sh</span> <span class="o">~/</span><span class="n">persistent</span><span class="o">/</span><span class="n">krita</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j8</span> <span class="n">install</span>

<span class="c1"># start Krita</span>
<span class="o">../</span><span class="n">appimage</span><span class="o">-</span><span class="n">workspace</span><span class="o">/</span><span class="n">krita</span><span class="o">.</span><span class="n">appdir</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">krita</span>
</pre></div>
</div>
</section>
<section id="building-appimage-package-for-your-version-of-krita">
<h2><a class="toc-backref" href="#id6">Building AppImage package for your version of Krita</a><a class="headerlink" href="#building-appimage-package-for-your-version-of-krita" title="本標題的永久連結">¶</a></h2>
<p>If you want to build a portable package for your version of Krita, just enter
the container and type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">build_krita_appimage</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>The built package will be copied to <em>./persistent/</em> folder.</p>
<p>By default, the package will be built in release mode. If you want to
add debugging information, add <em>--debug</em> option to the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">build_krita_appimage</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">debug</span>
</pre></div>
</div>
</section>
<section id="creating-a-full-clone-of-the-container">
<h2><a class="toc-backref" href="#id7">Creating a full clone of the container</a><a class="headerlink" href="#creating-a-full-clone-of-the-container" title="本標題的永久連結">¶</a></h2>
<p>It is possible to copy the container with the entire environment, sources,
build directory and QtCreator installation and configuration. After cloning,
no rebuild of Krita is needed!</p>
<p>To copy container to <em>../krita-auto-2</em>, just type in the host system</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn</span><span class="o">-</span><span class="n">clone</span> <span class="o">-</span><span class="n">d</span> <span class="o">../</span><span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
<p><em>spawn-clone</em> will make an image from the current container and create a
new one out of it. This image will be cached for further usages. If you need
to flush the cache, pass <em>-f</em> option to <em>spawn-clone</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn</span><span class="o">-</span><span class="n">clone</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">d</span> <span class="o">../</span><span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
<p>You can start several instances of <em>spawn-clone</em> on the same container
concurrently (e.g. for building multiple merge requests). It has internal
locking mechanism for resolving concurrency problems</p>
</section>
<section id="testing-merge-requests-using-container-clones">
<h2><a class="toc-backref" href="#id8">Testing merge requests using container clones</a><a class="headerlink" href="#testing-merge-requests-using-container-clones" title="本標題的永久連結">¶</a></h2>
<p>To quickly build a merge request '123' basing on the current state of the
container type in the host system</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn</span><span class="o">-</span><span class="n">clone</span> <span class="o">-</span><span class="n">m</span> <span class="mi">123</span> <span class="o">-</span><span class="n">be</span>
</pre></div>
</div>
<p>The script will clone the container, checkout the merge request branch,
build it and provide you a terminal for running Krita. The container
will be created at <em>./clones/clone-mr-123</em> subfolder of the current container.</p>
<p>If you also want to build an AppImage, add <em>--release-appimage</em> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn</span><span class="o">-</span><span class="n">clone</span> <span class="o">-</span><span class="n">m</span> <span class="mi">123</span> <span class="o">--</span><span class="n">release</span><span class="o">-</span><span class="n">appimage</span> <span class="o">-</span><span class="n">be</span>
</pre></div>
</div>
<p>AppImage will be places at <em>./persistent</em> subfolder of the clone.
When finished with testing the merge request, you can remove the clone
completely by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">discard</span><span class="o">-</span><span class="n">clone</span> <span class="o">/</span><span class="n">clones</span><span class="o">/</span><span class="n">clone</span><span class="o">-</span><span class="n">mr</span><span class="o">-</span><span class="mi">123</span>
</pre></div>
</div>
<p>You can build multiple merge requests at once!</p>
</section>
<section id="updating-dependencies-in-the-docker">
<h2><a class="toc-backref" href="#id9">Updating dependencies in the docker</a><a class="headerlink" href="#updating-dependencies-in-the-docker" title="本標題的永久連結">¶</a></h2>
<p>Sometimes dependencies in Krita change and building Krita or making the AppImage fails. To fix that, you need to update the dependencies.</p>
<div class="admonition note">
<p class="admonition-title">備註</p>
<p>This method is slow, because you need to rebuild the whole docker, which includes rebuilding whole Krita.</p>
</div>
<p>Run those commands in the console in the host system. If you want to update the dependencies in a clone docker, just go to the clone directory where you see <code class="docutils literal notranslate"><span class="pre">bin</span></code> and <code class="docutils literal notranslate"><span class="pre">persistent</span></code> directories and run those commands there.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove old dependencies</span>
<span class="n">rm</span> <span class="o">./</span><span class="n">persistent</span><span class="o">/</span><span class="n">krita</span><span class="o">-</span><span class="n">appimage</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">tar</span>

<span class="c1"># download new deps</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">sh</span>

<span class="c1"># build image</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">build_image</span> <span class="n">krita</span><span class="o">-</span><span class="n">deps</span>

<span class="c1"># remove the current container</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">remove_container</span> <span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">1</span>

<span class="c1"># run the container (it will create one)</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">run_container</span> <span class="n">krita</span><span class="o">-</span><span class="n">deps</span> <span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>After that you need to build Krita in the docker as usual.</p>
</section>
<section id="extra-developer-tools">
<h2><a class="toc-backref" href="#id10">Extra developer tools</a><a class="headerlink" href="#extra-developer-tools" title="本標題的永久連結">¶</a></h2>
<p>To install QtCreator, enter the container and start the installer, downloaded while fetching dependencies. Make sure you install it into '~/qtcreator' directory without any version suffixes, then you will be able to use the script below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># inside the container</span>
<span class="o">./</span><span class="n">persistent</span><span class="o">/</span><span class="n">qt</span><span class="o">-</span><span class="n">creator</span><span class="o">-</span><span class="n">opensource</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">run</span>
</pre></div>
</div>
<p>To start QtCreator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># from the host</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">qtcreator</span>
</pre></div>
</div>
</section>
<section id="stopping-the-container-and-cleaning-up">
<h2><a class="toc-backref" href="#id11">Stopping the container and cleaning up</a><a class="headerlink" href="#stopping-the-container-and-cleaning-up" title="本標題的永久連結">¶</a></h2>
<p>When not in use you can stop the container. All your filesystem state is saved, but all the currently running processes are killed (just ensure you logout from all the terminals before stopping).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># stop the container</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">stop</span>

<span class="c1"># start the container</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">start</span>
</pre></div>
</div>
<p>If you don't need your container/image anymore, you can delete them from the docker</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove the container</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">rm</span> <span class="n">krita</span><span class="o">-</span><span class="n">auto</span><span class="o">-</span><span class="mi">1</span>

<span class="c1"># remove the image</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">rmi</span> <span class="n">krita</span><span class="o">-</span><span class="n">deps</span>
</pre></div>
</div>
</section>
<section id="troubleshooting">
<h2><a class="toc-backref" href="#id12">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="本標題的永久連結">¶</a></h2>
<section id="krita-binary-is-not-found-after-the-first-build">
<h3><a class="toc-backref" href="#id13">Krita binary is not found after the first build</a><a class="headerlink" href="#krita-binary-is-not-found-after-the-first-build" title="本標題的永久連結">¶</a></h3>
<p>Either relogin to the container or just execute <cite>source ~/.devenv.inc</cite></p>
</section>
<section id="opengl-doesn-t-work-on-nvidia-gpu-with-proprietary-drivers">
<h3><a class="toc-backref" href="#id14">OpenGL doesn't work on NVidia GPU with proprietary drivers</a><a class="headerlink" href="#opengl-doesn-t-work-on-nvidia-gpu-with-proprietary-drivers" title="本標題的永久連結">¶</a></h3>
<p>The docker run script automatically forwards the GPU devices into the container, but it doesn't install the drivers for the GPU. You should install exactly the same version of the driver that is installed on your host system. Just run the following script when you are on host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">install_nvidia_drivers</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cmake_settings_for_developers.html" class="btn btn-neutral float-right" title="CMake Settings for Developers" accesskey="n" rel="next"> <!-- 下一個 --> <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="auto_build_script.html" class="btn btn-neutral" title="Half-automatic building script on Windows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> <!-- 上一個  -->  </a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; 版權所有 licensed under the GNU Free Documentation License 1.3+ unless stated otherwise。
      
        <span class="commit">
          修訂版本 <code>12c8f81</code>
        </span>
      

    </p>
  </div>
  使用 <a href="http://sphinx-doc.org/">Sphinx</a> 以及經修改過的 <a href="https://github.com/rtfd/sphinx_rtd_theme">RTD 主題</a>建置<br/>
  <a href="https://krita.org" title="Krita official website.">Krita 官方網站</a> |
  <a href="https://invent.kde.org/documentation/docs-krita-org/" title="這份手冊在 KDE 的 GitLab 網址">docs.krita.org 的 Git 原始碼儲存庫</a> |
  <a href="https://www.kde.org/community/whatiskde/impressum-en.php" title="了解更多關於 KDE、code of conduct、privacy policy 及 GDPR">KDE Impressum</a>
   

</footer>

        </div>
      </div>

    </section>

  </div>
  

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'5.0.0 Beta',
            LANGUAGE:'zh_TW',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

 <script type="text/javascript">
	 var _paq=_paq||[];
	 _paq.push(['setCookieDomain','*.krita.org']);
	 _paq.push(['setDomains','*.krita.org']);
	 _paq.push(['setDocumentTitle',document.domain+"/"+document.title]);
	 _paq.push(['trackPageView']);
	 _paq.push(['enableLinkTracking']);

	 (function(){
	 	var u="//stats.kde.org/";
	    _paq.push(['setTrackerUrl',u+'piwik.php']);
	    _paq.push(['setSiteId',13]);
	    var d = document, g = d.createElement('script'),s=d.getElementsByTagName('script')[0];
	    g.type = 'text/javascript';
	    g.async = true;
	    g.defer = true;
	    g.src = u+'piwik.js';
	    s.parentNode.insertBefore(g,s);
	  })();
</script> 
<noscript><p><img src="//stats.kde.org/piwik.php?idsite=13" style="border:0;" alt="" /></p></noscript>

</body>
</html>